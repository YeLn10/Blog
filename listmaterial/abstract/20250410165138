本题其实却是不难，当然官解似乎很有操作。但是我对于笛卡尔树理解比较浅薄。

首先，本题不能先求出不删的答案然后减掉删后的贡献，因为非常难求，对于$[L_i,i]$和$[R_i,i]$的区间，非常难以求出答案，因为每个$j$延伸出的答案都会不一样。

于是很经典的，求每个$a[j]$的贡献，这样子就可以去分情况而不用枚举来算延伸到哪里了。然后看看情况，我们要求出删掉每个$i$的答案，于是看看是否是可以整体贡献的。是可以的。

对于$[1,L_i-1]$和$[R_i+1,n]$是可以直接计算的，贡献